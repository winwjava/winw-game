<!DOCTYPE html>
<html>
<head>
<title>winw-game</title>
<meta charset="utf-8">
<script type="text/javascript"
	src="/jquery-2.2.4.min.js"></script>

<script type="text/javascript"
	src="/echarts.min.js"></script>

</head>
<body>
	<div id="main" style="width: 100%; height: 630px; margin: 0px auto"></div>
</body>
<script>
	var chartDom = document.getElementById('main');
	var myChart = echarts.init(chartDom);
	var option;
	$.get('/SubjectIndex/getIndexQuoteList0?days=30', function(_rawData) {
		run(_rawData);
	});

	const seriesList = [];
	const datasetWithFilters = [];

	function run(_rawData) {
		 var names = [];

		 for (let i = 1; i < _rawData.length; i++) {
			 if(names.indexOf(_rawData[i][2]) === -1){
				 names.push(_rawData[i][2]);
			  }
		 } 
		 console.log(names);
		 names.forEach(function(_item) {
			var datasetId = 'dataset_' + _item;
			 datasetWithFilters.push({
				id : datasetId,
				fromDatasetId : 'dataset_raw',
			 transform: {
			  type: 'filter',
			  config: {
			    and: [
			      { dimension: 'name', '=': _item }
			    ]
			  }
			} 
			}); 
			seriesList.push({
				type : 'line',
				datasetId : datasetId,
				showSymbol : false,
				name : _item,
				 endLabel : {
					show : true,
					formatter : function(params) {
						return params[2];
					}
				}, 
				labelLayout : {
					moveOverlap : 'shiftY'
				},
				emphasis : {
					focus : 'series'
				},
				encode : {
					x : 'date',
					y : 'close',
					label : [ 'name', 'close' ],
					itemName : 'date',
					tooltip : [ 'close' ]
				}
			});
		});

		  option = {
		    animationDuration: 0,
		    dataset: [
		      {
		        id: 'dataset_raw',
		        source: _rawData
		      },
		      ...datasetWithFilters
		    ],
		    //title: {
		      //text: 'Trend of Subject Index '
		    //},
		    tooltip: {// 鼠标滑过的提示框
		     // order: 'valueDesc',
		     // trigger: 'axis'
		    },
		    xAxis: {
		      type: 'category',
		      nameLocation: 'middle'
		    },
		    yAxis: {
		      name: 'Change'
		    },
		    grid: {
		      //right: 140,
	            top: '1%',  
	            left: '1%', 
	            right: '8%',
	            bottom: '1%',
	            containLabel: true
		    },
		    series: seriesList
		  };
		  myChart.setOption(option);
		  
	}
</script>
</html>